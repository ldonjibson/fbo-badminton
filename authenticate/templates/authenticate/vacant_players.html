{% extends 'authenticate/base.html' %}
{% load static %}

{% block content %}

<h1>Your team</h1>
{% if user.is_authenticated %}

<div class="container">
  <div class="row">
    <div class="col-sm">
    <table class="table table-hover" id="your-table">
    <thead>
        <tr>
            <th scope="col">Event</th>
            <th scope="col">Player</th>
            <th scope="col">Country</th>
            <th scope="col">Price(£)</th>
            <th scope="col">Last Tournament</th>
            <th scope="col">Current Tournament</th>
          </tr>
      </thead>
      <tbody>
      {% for player in MSplayers_user %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">MS{{ forloop.counter }}</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td><a class="btn btn-danger sell" role="button">Sell</a></td>
        </tr>
      {% endfor %}
      {% for player in WSplayers_user %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">WS{{ forloop.counter }}</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td><a class="btn btn-danger sell" role="button">Sell</a></td>
        </tr>
      {% endfor %}
      {% for player in MDplayers_user %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">MD{{ forloop.counter }}</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>

          <td><a class="btn btn-danger sell" role="button">Sell</a></td>
        </tr>
      {% endfor %}
      {% for player in WDplayers_user %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">WD{{ forloop.counter }}</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td><a class="btn btn-danger sell" role="button">Sell</a></td>
        </tr>
      {% endfor %}
      {% for player in XDplayer_user %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">XD{{ forloop.counter }}</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td><a class="btn btn-danger sell" role="button">Sell</a></td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    </div>
	<div class="row">
	<div class="col-sm">
	<h1>Players list</h1>
	<table class="table table-hover" id="vacant-table">

    <thead>
        <tr>
            <th scope="col">Event</th>
            <th scope="col">Player</th>
            <th scope="col">Country</th>
            <th scope="col">Price(£)</th>
            <th scope="col">Last Tournament</th>
            <th scope="col">Current Tournament</th>
          </tr>
      </thead>
      <tbody>

      {% for player in MSplayers %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">MS</th>
          <td><a class="player-name" href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td>{% if not player.team %}
          {% if team.MSplayers.all|length < 2 %}
	          <a class="btn btn-danger buy" role="button">Buy</a>
          {% else %}
	          <a class="" role="button">No slots for {{ player.get_type }}</a>
          {% endif %}</td>
          {% else %}
	          <a class="btn btn-secondary" role="button" disabled>Buy</a>
          {% endif %}
	        </td>
        </tr>
      {% endfor %}
      {% for player in WSplayers %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">WS</th>
          <td class="player-name" ><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
         <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td>{% if not player.team %}
          {% if team.WSplayers.all|length < 2 %}
	          <a class="btn btn-danger buy" role="button">Buy</a>
          {% else %}
	          <a class="" role="button">No slots for {{ player.get_type }}</a>
          {% endif %}</td>
          {% else %}
	          <a class="btn btn-secondary" role="button" disabled>Buy</a>
          {% endif %}
	        </td>
        </tr>
      {% endfor %}
      {% for player in MDplayers %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">MD</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>

          <td>{% if not player.team %}
          {% if team.MDplayers.all|length < 2 %}
	          <a  class="btn btn-danger buy" role="button">Buy</a>
          {% else %}
	          <a class="" role="button">No slots for {{ player.get_type }}</a>
          {% endif %}</td>
          {% else %}
	          <a class="btn btn-secondary" role="button" disabled>Buy</a>
          {% endif %}
	        </td>
        </tr>
      {% endfor %}
      {% for player in WDplayers %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">WD</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td>{% if not player.team %}
          {% if team.WDplayers.all|length < 2 %}
	          <a class="btn btn-danger buy" role="button">Buy</a>
          {% else %}
	          <a class="" role="button">No slots for {{ player.get_type }}</a>
          {% endif %}</td>
          {% else %}
	          <a class="btn btn-secondary" role="button" disabled>Buy</a>
          {% endif %}
	        </td>
        </tr>
      {% endfor %}
      {% for player in XDplayers %}
        <tr class="{{ player.id }}">
          <th class="player-type" scope="row">XD</th>
          <td class="player-name"><a href="#">{{ player.name }}</a></td>
          <td>{{ player.country }}</td>
          <td class="player-cost">{{ player.cost }}</td>
          <td>{{ player.last_tournament_score }}</td>
          <td>{{ player.current_tournament_score }}</td>
          <td>{% if not player.team %}
          {% if team.XDplayers.all|length < 2 %}
	          <a class="btn btn-danger buy" role="button">Buy</a>
          {% else %}
	          <a class="" role="button">No slots for {{ player.get_type }}</a>
          {% endif %}</td>
          {% else %}
	          <a class="btn btn-secondary" role="button" disabled>Buy</a>
          {% endif %}
	        </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    </div> 

    <div class="col-sm..offset-md-4">
      <div class="card border-danger mb-3" style="width: 18rem;">
        <div class="card-header">
        TEAM NAME
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item"><strong>Overall points:</strong> 1,234</br><strong>Global rank:</strong> 101</br><strong>Total players:</strong> 100,500</li>
          <li class="list-group-item"><strong>Current tournament points:</strong> 69</li>
          <li class="list-group-item"><a href="#"><strong>Your leagues</strong></a></li>
        </ul>
      </div>
      <div class="container border-danger">
        <div class="row">
          <div class="col-sm.offset-md-4">
          <table class="table table-hover">
            <tbody>
              <tr>
                <th scope="row">BUDGET (£)</th>
                <td id="budget">{{ team.budget }}</td>
              </tr>
              <tr>
                <th scope="row">TEAM VALUE (£)</th>
                <td>{{ team.get_team_value }}</td>
              </tr> 
            </tbody>
          </table>
          </div>
        </div>
      </div>
    </div>
	</div>
	</div>
	</div>
  </div>
</div> 
            
</br>
	<script>
	var d = document,
    vacantTable = d.getElementById('vacant-table');
	yourTable = d.getElementById('your-table');
	playersToBuy = [];
	playersToSell = [];
	budgetDOM = d.getElementById('budget');
	budget = d.getElementById('budget').innerHTML;



	var handleCart = function(e){
		const element = this.parentElement.parentElement;
	    let name = element.getElementsByClassName('player-name')[0].text,
	        type = element.getElementsByClassName('player-type')[0].innerHTML,
	        id = $(this).closest('tr')[0].className,
			cost = element.getElementsByClassName('player-cost')[0].innerHTML,
			row = $(this).closest('tr').remove().clone(true);



        if (this.className == 'btn btn-danger buy'){
		  $('#your-table tbody').append(row);
		  playersToBuy.push([id, type, name]);
		  row.find('a')[1].innerHTML = 'Bought';
          budgetDOM.innerHTML = Number(budget) - Number(cost);
		} else {
		  $('#vacant-table tbody').append(row);
		  playersToSell.push([id, type, name]);
		  row.find('a')[1].innerHTML = 'Sold';
          budgetDOM.innerHTML = Number(budget) + Number(cost);
		}


	    return false;
	}

	var buttonsVacant = vacantTable.getElementsByClassName('btn btn-danger buy');

	for (var i = 0; i < buttonsVacant.length; i++) {
        buttonsVacant[i].addEventListener('click', handleCart, false);
    }

	var buttonsYours = yourTable.getElementsByClassName('btn btn-danger sell');

	for (var i = 0; i < buttonsYours.length; i++) {
	    buttonsYours[i].addEventListener('click', handleCart, false);
	}



	</script>


{% endif %}
{% endblock %}